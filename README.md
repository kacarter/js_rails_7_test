# Rails 7 JavaScript/jQuery Demo App

This demo app shows how to get JavaScript to run on the initial visit to a page while keeping Turbo enabled. This is
accomplished by using a Stimulus controller's connect method. This app also includes using jQuery, since many gems still
require it. It also shows how to use a Stimulus controller to replace hard-coded `onclick` functionality, such as for a
visibility toggle button. I had a very difficult time finding all the different pieces required to get JavaScript and jQuery working 
properly in
a Rails 7 app without just turning off Turbo, so I thought I'd create a demo app showing the different bits and pieces.
I've included a list of the sources I used to create this demo app at the end.

* Ruby version: 3.1.3
* Rails version: 7.0.4

## Steps to install jQuery (and jQuery UI, if you need it):

* In your project's `Gemfile`, uncomment `gem "sassc-rails"`.
* Add these lines to the `Gemfile`:
```
  gem "jquery-rails"
  gem "jquery-ui-rails"
```
and run `bundle install`.
* In `config/initializers/assets.rb` add: 
```
Rails.application.config.assets.precompile += %w( jquery.min.js jquery_ujs.js jquery-ui.js )
```
* In `config/importmap.rb` add:
```
pin "jquery", to: "jquery.min.js", preload: true
pin "jquery_ujs", to: "jquery_ujs.js", preload: true
pin "jquery-ui", to: "jquery-ui.js", preload: true
```

## To get JavaScript working the first time you visit a page without disabling Turbo

1. Ensure your `config/importmap.rb` file includes a line pinning Stimulus controllers. The current default generated by
Rails will look like:
    ```
    pin_all_from "app/javascript/controllers", under: "controllers"
    ```
1. Generate a Stimulus controller for the page where you want to use some JavaScript, either manually or by running a
generator: `rails generate stimulus name-of-controller` or `rails generate stimulus name-of-controller/name-of-action`
depending on how much you want to divide things up. I've seen conflicting recommendations on this; some prefer to have a
Stimulus controller for each Rails controller's action which requires JavaScript in its view (e.g. if you have a User
model which needs JavaScript on its index page, you'd do `rails generate stimulus users/index` which would create
`app/javascript/controllers/users/index_controller.js`). However others say you should
create general purpose Stimulus controllers based on functionality, e.g. a `toggle_controller.js` for toggling visibility
on any element anywhere. The general purpose controller makes more sense to me from a code reuse perspective and from a
quick Google it seems like that's the more accepted best practice so far, but this is still pretty new and difficult to
Google so YMMV. 

1. Put your JavaScript inside the Stimulus controller. If it's code that only needs to run once on page load, such as
initializing a datepicker, put the code inside the `connect` method. If it's code that needs to be hooked up to a particular
element, the sort of thing for which you would set an `onclick` event in plain HTML/CSS/JavaScript, you can just create 
a custom method and put the code in there.

1. Hook the Stimulus controller up to your view. 
   * For code that only runs once on page load, it's super simple. Just add
an HTML attribute named `data-controller` with a value of the name of the Stimulus controller (e.g. 
`data-controller="users--index"` or `data-controller="datepicker"`) to an element that contains the element you want to act on. 
For instance if you have a form element
you want to turn into a datepicker, you could set the attribute on the form itself. 
   * For hooking up code to a particular element in place of an `onclick` event, you need the `data-controller` attribute
defined on a wrapping element as above, and you ALSO need to specify `data-action` on the element that triggers the custom
method. So for example if you have a custom method called `do_toggle` in a Stimulus controller called `toggle`, you'd 
need a button with `data-action="toggle#do_toggle"`.

This is the minimum you need to get going with JavaScript and jQuery in Rails 7. You can see an example of a jQuery
datepicker and a visibility toggle in this app.

## Bonus

You can create more dynamic, reusable controllers by defining targets in your Stimulus controller and passing in a specific
class when you attach the Stimulus controller to your HTML. You can also specify a target in your HTML. You can see
examples of this in `app/javascript/controllers/dynamic_toggle_controller.js` and `app/views/dynamic_things/index.html.erb`
and `app/javascript/controllers/dynamic_datepicker_controller.js` and `app/views/dynamic_things/_form.html.erb`

## References

* [Toggle example and info on writing reusable Stimulus controllers](https://boringrails.com/articles/better-stimulus-controllers/)
* [Stimulus best practices](https://www.betterstimulus.com/)
* [Getting JavaScript sprinkles to work on page load without turning off Stimulus](https://stackoverflow.com/questions/72902225/javascript-stops-working-when-a-link-is-clicked): 
this took me FOREVER to find, I kept finding SO results that said to turn off Turbo instead ðŸ˜ž
* [Installing jQuery with Rails 7](https://stackoverflow.com/questions/70921378/how-to-install-jquery-and-bootstrap-in-rails-7-app-using-esbuild-without-webpac)
